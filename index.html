let parsed;

if (typeof data.result === "string") {
  try {
    parsed = JSON.parse(data.result);
  } catch (e) {
    console.error("JSON parse error:", e, data.result);
    output.innerHTML = `<p class="error">AI response parsing failed</p>`;
    return;
  }
} else {
  parsed = data;
}

if (!parsed.companies) {
  output.innerHTML = `<p class="error">AI returned invalid format</p>`;
  return;
}

const c = parsed.companies[0];


